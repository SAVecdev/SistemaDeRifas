# Instrucciones del Proyecto - Actualizaci贸n Web

##  Contexto General
Este documento contiene las directrices, est谩ndares y preferencias que deben seguirse en todas las tareas de desarrollo de este proyecto.

---

##  Informaci贸n del Proyecto
**Nombre:** Rifaparatodos
**Fecha de inicio:** 4 de diciembre de 2025
**Descripci贸n:** {sistema de rifas en l铆nea para diversos productos y servicios. , 
este sistema permite a los usuarios participar en rifas de manera segura y transparente, facilitando la gesti贸n de sorteos y la interacci贸n entre organizadores y participantes. para las transparencia se realizara la rifa a travez de sorteos de loterias nacionales. de algun pais en especifico y se indicara cuantos numeros participan en la rifa y cuantos numeros tiene la loteria nacional. y si la rifa tomara los diferentes grados de los sorteos de la loteria nacional para los premios. , el proyecto debe tener 5 roles de usuario: administrador, supervisor, vendedor, usuario registrado y usuario no registrado. cada rol tendra diferentes permisos y accesos dentro del sistema. 
  administrador: gestion total del sistema, usuarios, rifas, premios, transacciones y configuraciones.
  supervisor: supervisa las rifas, usuarios y transacciones, puede supervisar los vendedores pero no puede modificar configuraciones del sistema puede ver las ventas y pagos que han realizado los vendedores pero no las puede modificar solo supervisar.
  vendedor: gestiona la venta de n煤meros de rifas y atiende a los usuarios registrados, puede registrar nuevos usuarios pagar a usuarios que lleguen a cobrar premios.
  usuario registrado: puede participar en rifas, ver su historial de transacciones y gestionar su perfil .
  usuario no registrado: puede ver rifas disponibles pero no participar ni gestionar perfil.
la gestion de los premios sera de dos maneras diferentes los numeros que se pueden vender seran de 2,3,4,5,6 digtios tomando los ultimos numeros de la loteria nacional. y los premios seran asignados segun los grados de la loteria nacional. los premios de 2 digitos seran menores a los premios de 6 digitos. y los premios varian segun la cantidad que se valla a apostar por lo que se necesita que se cree una tabla de configuracion para los premios segun la cantidad apostada y los grados de la loteria nacional. y esta puede ser diferente para cada rifa y local. la segunda manera es una rifa simple de un solo valor fijo y un solo numero por rifa con un numero establecido por el organizador de la rifa que puenden ser de 2 a 6 digitos. y el premio sera un valor fijo establecido por el organizador de la rifa. 
si es de 2 digitos los numeros solo se venderan una sola vez comenzando del 00 al 99. si es de 3 digitos comenzando del 000 al 999. si es de 4 digitos comenzando del 0000 al 9999. si es de 5 digitos comenzando del 00000 al 99999. si es de 6 digitos comenzando del 000000 al 999999. y el premio sera un valor fijo establecido por el organizador de la rifa.
1. **Frontend:** el front debera llevar un asidebar para poder navegar entre las diferentes secciones segun el rol del usuario. y un header con el logo y opciones de perfil y cierre de sesion.
Navegacion:
Administrador{
  - Dashboard: vista general con estadisticas y resumen de actividades
  - Rifas: gestion de rifas (crear, editar, eliminar, ver detalles)
  - Usuarios: gestion de usuarios (ver, editar, eliminar)
  - Sorteos: control y ejecucion de sorteos programados
  - Clientes: gestion de clientes (ver, editar, eliminar, agregar saldo, pagar premios)
  - Premios: gestion de premios por rifa y tipo (crear, editar, eliminar)
  - Reportes: generacion de reportes y exportacion de datos
  - opciones a ganar: gestion de los premios segun el tipo de rifa y el area y el valor apostado
  - Configuracion: ajustes generales del sistema ajustes de los parametros de las facturas que se generen
  y las diferencias al momento de generar e imprimir las facturas. ya que cada usuario puede tener diferentes necesidades.
}
Supervisor{
  - Dashboard: vista general con estadisticas y resumen de actividades de todos los vendedores a su cargo
  - Rifas: ver rifas (solo lectura)
  - Usuarios: ver usuarios (solo lectura)
  - Vendedores: gestion de vendedores (ver, supervisar)
  - Reportes: generacion de reportes y exportacion de datos
}
Vendedor{
  - Dashboard: vista general con estadisticas y resumen de actividades propias
  - Rifas: ver rifas disponibles para venta
  - Clientes: gestion de clientes (registrar, ver historial , recargar saldo, pagar premios del usuario)
  - Ventas: registro de ventas y pagos de premios las facturas se imprimen automaticamente al momento de realizar una venta
  - Facturas: generacion e impresion de facturas por ventas realizadas
  - Historial de ventas: ver historial de ventas realizadas
  - Premios pagados: ver historial de premios pagados a clientes
}
Usuario Registrado{
  - Dashboard: vista general con rifas activas y resumen de actividades propias
  - Rifas: ver rifas disponibles, comprar numeros, ver detalles de rifas
  - Mi Perfil: gestion de perfil personal (ver, editar)
  - Historial de Rifas: ver historial de rifas participadas
  - Transacciones: ver historial de transacciones y recargas de saldo
}

**tablas principales:**
todas las tablas deben estar paginadas y tener opciones de busqueda y filtros segun los campos relevantes de cada tabla. y deben tener opciones de ordenamiento ascendente y descendente.
las tablas deben tener un dise帽o limpio y facil de usar, con colores y tipografia consistentes con el resto del sistema. y deben ser responsivas para adaptarse a diferentes tama帽os de pantalla.
**Backend:** revisa siempre el esquema para asegurarte de que el fron tiene las tablas y campos necesarios para mostrar la informacion requerida por el fron. y que las relaciones entre tablas son correctas para evitar inconsistencias en los datos.
---

##  Stack Tecnol贸gico
- **Frontend:** React
- **Backend:** Node.js
- **Base de Datos:** MySQL
- **Herramientas:** [Especificar herramientas adicionales]

---

##  Est谩ndares de C贸digo

### Nomenclatura
- **Variables:** camelCase
- **Funciones:** camelCase
- **Clases:** PascalCase
- **Archivos:** PascalCase
- **Constantes:** UPPER_CASE

### Estructura de Directorios
de tipo screaming structure

### Comentarios y Documentaci贸n
- Usar comentarios en espa帽ol
- Documentar funciones complejas
- Incluir JSDoc/docstrings cuando sea necesario

---

##  Preferencias de Desarrollo

### Framework/Librer铆as Preferidas
- [Listar librer铆as o frameworks espec铆ficos a usar]

### Patrones de Dise帽o
- [MVC, MVVM, Repository Pattern, etc.]

### Gesti贸n de Estado
- [Redux, Vuex, Context API, etc.]

### Estilos
- [CSS Modules, Styled Components, Tailwind, SASS, etc.]

---

## И Testing

### Framework de Testing
- [Jest, Mocha, Pytest, etc.]

### Cobertura Requerida
- [Especificar porcentaje m铆nimo]

---

##  Seguridad

### Pr谩cticas de Seguridad
- Nunca incluir credenciales en el c贸digo
- Usar variables de entorno para datos sensibles
- Validar todas las entradas de usuario
- Implementar autenticaci贸n y autorizaci贸n adecuadas

---

##  APIs y Servicios Externos

### APIs Utilizadas
- [Listar APIs externas]

### Autenticaci贸n
- [OAuth, JWT, API Keys, etc.]

---

##  Dependencias

### Instalaci贸n
```bash
[Comandos de instalaci贸n preferidos]
```

### Gesti贸n de Paquetes
- npm

---

##  Despliegue

### Entornos
- **Desarrollo:** [URL o configuraci贸n]
- **Staging:** [URL o configuraci贸n]
- **Producci贸n:** [URL o configuraci贸n]

### Proceso de Despliegue
1. [Desarrollo de las vistas]
2. [Desarrollo de la logica]
3. [Desarrollo de la base de datos]


##  Notas Importantes

### Antes de Cualquier Tarea:
- [ ] Leer estas instrucciones completamente
- [ ] Verificar el contexto del proyecto
- [ ] Confirmar los est谩ndares a seguir
- [ ] Respetar la estructura existente

### Durante el Desarrollo:
- Seguir los est谩ndares de c贸digo definidos
- Escribir c贸digo limpio y mantenible
- Comentar secciones complejas
- Realizar commits descriptivos

### Despu茅s de Completar una Tarea:
- Verificar que el c贸digo funcione correctamente
- Asegurar que no hay errores de sintaxis
- Comprobar que se siguen los est谩ndares
- Documentar cambios importantes

---

##  Control de Versiones

### Git Workflow
- [Gitflow, GitHub Flow, etc.]

### Formato de Commits
```
tipo(alcance): descripci贸n breve

Descripci贸n detallada si es necesario
```

**Tipos:** feat, fix, docs, style, refactor, test, chore

---

##  Contacto y Referencias

### Documentaci贸n Adicional
- [Enlaces a documentaci贸n]

### Recursos
- [Enlaces a recursos 煤tiles]

---

## 锔 Restricciones y Consideraciones Especiales

### NO hacer:
- No usar `new Date()` de JavaScript para comparar con fechas de MySQL
- No usar fechas del servidor Node.js para validaciones de negocio que dependen de datos de MySQL

### SIEMPRE hacer:
- **FECHAS Y HORAS**: NUNCA comparar fechas de MySQL con JavaScript `new Date()`
  - Las fechas en MySQL est谩n en formato `'YYYY-MM-DD HH:MM:SS'` (ej: '2025-12-06 19:45:00')
  - **HACER LA COMPARACIN DIRECTAMENTE EN LA QUERY SQL** usando operadores de MySQL
  - Ejemplo correcto: `SELECT CASE WHEN fecha_hora_juego > NOW() THEN 1 ELSE 0 END as puede_hacer FROM tabla`
  - NO convertir a JavaScript Date para comparar, usar el resultado booleano de MySQL
  - Esto garantiza misma zona horaria y evita problemas de conversi贸n UTC/local

- **PAGOS DE PREMIOS**: Validaci贸n de tiempo m谩ximo de 8 d铆as
  - Los premios solo pueden ser pagados dentro de los 8 d铆as posteriores al sorteo
  - Validar en backend usando: `DATEDIFF(NOW(), fecha_hora_juego) <= 8`
  - Mostrar en frontend premios expirados con badge rojo y desactivar bot贸n de pago
  - Mensaje de error: "No se puede pagar este premio. Han transcurrido X d铆as desde el juego (m谩ximo permitido: 8 d铆as)"
  - Esta validaci贸n aplica tanto para pago individual como m煤ltiple

- Usar transacciones para operaciones cr铆ticas
- Validar permisos seg煤n rol de usuario
- Mantener logs claros en operaciones importantes

---

**ltima actualizaci贸n:** 4 de diciembre de 2025

---

##  Instrucciones Espec铆ficas para el Asistente

Cuando te pidan realizar cualquier tarea en este proyecto:

1. **SIEMPRE** lee este archivo primero
2. Aplica los est谩ndares y preferencias aqu铆 definidos
3. Si algo no est谩 claro, pregunta antes de proceder
4. Mant茅n la consistencia con el c贸digo existente
5. Respeta las convenciones establecidas

**Este archivo es la fuente de verdad para todas las decisiones de desarrollo en este proyecto.**
